{# app/templates/admin/parent_edit.html #}
{% extends 'admin/model/edit.html' %}
{% from 'admin/lib.html' import render_form with context %}

{# This block renders the standard form fields #}
{% block edit_form %}
    {{ render_form(form) }}
{% endblock %}

{# This is our new block for the live preview #}
{% block tail %}
    {{ super() }}

    <div class="live-preview-container">
        <h3>Live Preview</h3>
        <div class="parent-name-banner">
            <h1 id="preview-parent-name" class="display-5 text-white text-uppercase text-center py-3"></h1>
        </div>
        <div class="container my-5">
            <div class="row g-4 parent-layout-container">
                <div class="col-md-6 parent-image-column">
                    <div class="parent-carousel-wrapper">
                        {# --- THIS IS THE FIX --- #}
                        {#
                          Add a conditional check to handle the 'create' view where 'model' does not exist.
                          - If the model and its image key exist (i.e., we are editing), generate the pre-signed URL.
                          - Otherwise (i.e., we are creating), use a placeholder image.
                        #}
                        <img id="preview-parent-image" 
                             src="{% if model and model.main_image_s3_key %}{{ model.main_image_s3_key | s3_url }}{% else %}{{ url_for('static', filename='img/placeholder.jpg') }}{% endif %}"
                             class="d-block w-100 carousel-image" 
                             alt="Parent image preview">
                    </div>
                </div>
                <div class="col-md-6 parent-info-column">
                    <div class="text-center mt-md-0 mt-4">
                        <h3 class="breed-header" id="preview-parent-breed"></h3>
                    </div>
                    <div class="description-paragraphs mt-4" id="preview-parent-description">
                        {# Description content will be injected here by JavaScript #}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/admin_content_preview.js') }}"></script>
{% endblock %}